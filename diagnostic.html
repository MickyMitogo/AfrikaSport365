<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîç CMS Diagnostic Tool - AfrikaSport365</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        .header h1 {
            font-size: 2rem;
            margin-bottom: 10px;
        }
        .content {
            padding: 30px;
        }
        .test-section {
            background: #f8fafc;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .test-section h2 {
            color: #1e40af;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .test-section h2 .icon {
            font-size: 1.5rem;
        }
        .result {
            background: white;
            border-left: 4px solid #94a3b8;
            padding: 15px;
            margin: 10px 0;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }
        .result.success {
            border-left-color: #10b981;
            background: #ecfdf5;
        }
        .result.error {
            border-left-color: #ef4444;
            background: #fef2f2;
        }
        .result.warning {
            border-left-color: #f59e0b;
            background: #fffbeb;
        }
        .result.info {
            border-left-color: #3b82f6;
            background: #eff6ff;
        }
        .btn {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: background 0.3s;
            margin: 5px;
        }
        .btn:hover {
            background: #2563eb;
        }
        .btn.danger {
            background: #ef4444;
        }
        .btn.danger:hover {
            background: #dc2626;
        }
        .btn.success {
            background: #10b981;
        }
        .btn.success:hover {
            background: #059669;
        }
        pre {
            background: #1e293b;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 6px;
            overflow-x: auto;
            margin: 10px 0;
        }
        .actions {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }
        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 700;
            text-transform: uppercase;
        }
        .status-badge.ok {
            background: #d1fae5;
            color: #065f46;
        }
        .status-badge.fail {
            background: #fee2e2;
            color: #991b1b;
        }
        .status-badge.pending {
            background: #fef3c7;
            color: #92400e;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîç CMS Diagnostic Tool</h1>
            <p>AfrikaSport365 - Frontend Update Troubleshooter</p>
        </div>
        
        <div class="content">
            <!-- Test 1: Check JSON Files -->
            <div class="test-section">
                <h2><span class="icon">üìÑ</span> Test 1: JSON Files Accessibility</h2>
                <p>Checking if JSON files are accessible from frontend...</p>
                <div id="test1-results"></div>
                <div class="actions">
                    <button class="btn" onclick="runTest1()">üîÑ Run Test</button>
                </div>
            </div>

            <!-- Test 2: Check Cache -->
            <div class="test-section">
                <h2><span class="icon">üíæ</span> Test 2: Browser Cache Status</h2>
                <p>Checking ContentLoader cache (5-minute duration)...</p>
                <div id="test2-results"></div>
                <div class="actions">
                    <button class="btn" onclick="runTest2()">üîÑ Check Cache</button>
                    <button class="btn danger" onclick="clearAllCache()">üóëÔ∏è Clear Cache</button>
                </div>
            </div>

            <!-- Test 3: Compare JSON Files -->
            <div class="test-section">
                <h2><span class="icon">‚öñÔ∏è</span> Test 3: Compare content.json vs config.json</h2>
                <p>Checking which file has the most recent data...</p>
                <div id="test3-results"></div>
                <div class="actions">
                    <button class="btn" onclick="runTest3()">üîÑ Compare Files</button>
                </div>
            </div>

            <!-- Test 4: Reload Homepage Data -->
            <div class="test-section">
                <h2><span class="icon">üîÑ</span> Test 4: Force Reload Homepage Content</h2>
                <p>Bypass cache and reload fresh data from content.json...</p>
                <div id="test4-results"></div>
                <div class="actions">
                    <button class="btn success" onclick="forceReload()">üöÄ Force Reload Content</button>
                    <button class="btn" onclick="window.location.href='index.html'">üè† Go to Homepage</button>
                </div>
            </div>

            <!-- Test 5: Dashboard Verification -->
            <div class="test-section">
                <h2><span class="icon">‚öôÔ∏è</span> Test 5: Dashboard Save Verification</h2>
                <p>Verify dashboard is saving to content.json correctly...</p>
                <div id="test5-results"></div>
                <div class="actions">
                    <button class="btn" onclick="window.location.href='admin/dashboard.php'">üìä Open Dashboard</button>
                </div>
            </div>
        </div>
    </div>

    <script src="js/content-loader.js"></script>
    <script>
        // Test 1: Check JSON File Accessibility
        async function runTest1() {
            const results = document.getElementById('test1-results');
            results.innerHTML = '<div class="result info">Testing...</div>';
            
            let html = '';
            
            // Test content.json
            try {
                const contentRes = await fetch('/data/content.json');
                if (contentRes.ok) {
                    const contentData = await contentRes.json();
                    html += `<div class="result success">
                        ‚úÖ <strong>content.json</strong> - Status: ${contentRes.status} OK<br>
                        üì¶ Size: ${JSON.stringify(contentData).length} bytes<br>
                        üïê Last Updated: ${contentData.lastUpdated || 'N/A'}<br>
                        üìù Sections: ${Object.keys(contentData).length}
                    </div>`;
                } else {
                    html += `<div class="result error">‚ùå content.json - Status: ${contentRes.status}</div>`;
                }
            } catch (e) {
                html += `<div class="result error">‚ùå content.json - Error: ${e.message}</div>`;
            }
            
            // Test config.json
            try {
                const configRes = await fetch('/data/config.json');
                if (configRes.ok) {
                    const configData = await configRes.json();
                    html += `<div class="result success">
                        ‚úÖ <strong>config.json</strong> - Status: ${configRes.status} OK<br>
                        üì¶ Size: ${JSON.stringify(configData).length} bytes<br>
                        üìù Sections: ${Object.keys(configData).length}
                    </div>`;
                } else {
                    html += `<div class="result error">‚ùå config.json - Status: ${configRes.status}</div>`;
                }
            } catch (e) {
                html += `<div class="result error">‚ùå config.json - Error: ${e.message}</div>`;
            }
            
            results.innerHTML = html;
        }

        // Test 2: Check Cache Status
        async function runTest2() {
            const results = document.getElementById('test2-results');
            
            let html = '<div class="result info"><strong>Cache Status:</strong></div>';
            
            if (typeof ContentLoader !== 'undefined') {
                html += '<div class="result success">‚úÖ ContentLoader is loaded</div>';
                
                // Check if content.json is cached
                try {
                    const data = await ContentLoader.load('content');
                    html += `<div class="result warning">
                        ‚ö†Ô∏è <strong>content.json is CACHED</strong><br>
                        This means you're seeing OLD data from up to 5 minutes ago.<br>
                        Click "Clear Cache" to force fresh data.
                    </div>`;
                } catch (e) {
                    html += '<div class="result error">‚ùå Error loading content: ' + e.message + '</div>';
                }
            } else {
                html += '<div class="result error">‚ùå ContentLoader not available</div>';
            }
            
            results.innerHTML = html;
        }

        // Clear Cache
        function clearAllCache() {
            if (typeof ContentLoader !== 'undefined' && ContentLoader.clearCache) {
                ContentLoader.clearCache();
                document.getElementById('test2-results').innerHTML = `
                    <div class="result success">
                        ‚úÖ <strong>Cache Cleared!</strong><br>
                        Next page load will fetch fresh data from content.json
                    </div>`;
            } else {
                document.getElementById('test2-results').innerHTML = `
                    <div class="result error">‚ùå ContentLoader.clearCache() not available</div>`;
            }
        }

        // Test 3: Compare Files
        async function runTest3() {
            const results = document.getElementById('test3-results');
            results.innerHTML = '<div class="result info">Comparing files...</div>';
            
            try {
                const [contentRes, configRes] = await Promise.all([
                    fetch('/data/content.json'),
                    fetch('/data/config.json')
                ]);
                
                const contentData = await contentRes.json();
                const configData = await configRes.json();
                
                let html = '<div class="result info"><strong>Comparison Results:</strong></div>';
                
                // Compare hero titles
                const contentHero = contentData.hero?.title || 'N/A';
                const configHero = configData.hero?.title || 'N/A';
                
                html += `<div class="result ${contentHero === configHero ? 'warning' : 'success'}">
                    <strong>Hero Title:</strong><br>
                    üìÑ content.json: "${contentHero}"<br>
                    üìÑ config.json: "${configHero}"<br>
                    ${contentHero === configHero ? '‚ö†Ô∏è IDENTICAL - Check if dashboard saved correctly' : '‚úÖ DIFFERENT - content.json has newer data'}
                </div>`;
                
                // Check which has more data
                const contentKeys = Object.keys(contentData).length;
                const configKeys = Object.keys(configData).length;
                
                html += `<div class="result info">
                    <strong>Data Completeness:</strong><br>
                    üìÑ content.json: ${contentKeys} sections<br>
                    üìÑ config.json: ${configKeys} sections<br>
                    ${contentKeys > configKeys ? '‚úÖ content.json is MORE COMPLETE (recommended)' : '‚ö†Ô∏è config.json has more sections'}
                </div>`;
                
                results.innerHTML = html;
            } catch (e) {
                results.innerHTML = `<div class="result error">‚ùå Error comparing files: ${e.message}</div>`;
            }
        }

        // Force Reload
        async function forceReload() {
            const results = document.getElementById('test4-results');
            results.innerHTML = '<div class="result info">üîÑ Clearing cache and reloading...</div>';
            
            try {
                // Clear cache
                if (typeof ContentLoader !== 'undefined') {
                    ContentLoader.clearCache();
                }
                
                // Force reload content.json
                const response = await fetch('/data/content.json?t=' + Date.now());
                const data = await response.json();
                
                results.innerHTML = `
                    <div class="result success">
                        ‚úÖ <strong>Success!</strong> Fresh data loaded from content.json<br>
                        üéØ Hero Title: "${data.hero?.title || 'N/A'}"<br>
                        üïê Last Updated: ${data.lastUpdated || 'N/A'}
                    </div>
                    <div class="result info">
                        ‚ÑπÔ∏è <strong>Next Step:</strong> Go to homepage and hard-refresh (Ctrl+Shift+R or Ctrl+F5)
                    </div>`;
            } catch (e) {
                results.innerHTML = `<div class="result error">‚ùå Error: ${e.message}</div>`;
            }
        }

        // Auto-run basic tests on load
        window.addEventListener('DOMContentLoaded', () => {
            console.log('üîç Diagnostic Tool Ready');
            document.getElementById('test5-results').innerHTML = `
                <div class="result info">
                    <strong>Dashboard Check:</strong><br>
                    1. Open dashboard and make a change<br>
                    2. Save changes<br>
                    3. Come back here and click "Force Reload Content"<br>
                    4. Check if changes appear
                </div>`;
        });
    </script>
</body>
</html>
